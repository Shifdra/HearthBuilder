@using HearthBuilder.Models.Cards
@using HearthBuilder.Models.Decks
@using HearthBuilder.Models.Notifications
@using HearthBuilder.Models
@using HearthBuilder.Models.FilterDecks
@model HearthBuilder.Models.FilterDecks.SearchParams

@{
    ViewBag.Title = "Browse for Decks";
    bool shouldHide = false;
    string duplicateVisible = "";

}

<script>

</script>

<div class="container">
    <h1>Browse Decks</h1>

    <div class="filter">
        <div class="panel panel-default">
            <div class="panel-heading">
                <p>Pick One or More Classes</p>
            </div>
            @using (Html.BeginForm())
            {
                <div class="row" style="padding:15px;">
                    <div class="col-xs-12">
                        <div class="input-group">
                            @for (int i = 0; i < Model.Classes.Count; i++)
                            {
                                //THIS WORKS... WHY?
                                @Html.HiddenFor(m => m.Classes[i].PlayerClass)
                                @Html.LabelFor(m => m.Classes[i].Checked, Model.Classes[i].PlayerClass)
                                @Html.CheckBoxFor(m => m.Classes[i].Checked)
                                
                                //THIS DOESNT WORK, causes blank results
                                //@Html.CheckBoxFor(m => m.Classes[i].Checked, new { @autocomplete = "off" })
                                //@Html.DisplayName(Model.Classes[i].PlayerClass)
                            }
                        </div><br />

                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">
                                    @Html.LabelFor(model => model.DeckName, "Deck Name (optional):")
                                    @Html.TextBoxFor(model => model.DeckName)
                                </div>
                            </div>
                        </div><br /><br />

                        <div class="col-xs-12">
                            <input type="submit" value="Filter" class="btn btn-primary btn-block btn-danger btn-lg" />
                        </div>
                    </div>
                </div><br />
            }
        </div>
    </div>

    <div class="browseDeck">
       
        
        @foreach (Deck deck in ViewBag.decks)
        {
            <div class="deckList  text-center">
                <a href="/Deck/View/@deck.Id">
                    <div class="portrait">
                        <div class="@deck.ClassStr.ToLower()">
                            <i></i>
                            <span class="name">@deck.Title</span>
                        </div>
                    </div>
                    <div class="cards">
                        @for (int cardId = 0; cardId < deck.Cards.Count; cardId++)
                        {
                            shouldHide = false;
                            duplicateVisible = "";
                            for (int tmpCardId = 0; tmpCardId < deck.Cards.Count; tmpCardId++)
                            {
                                if (deck.Cards[cardId].Id == deck.Cards[tmpCardId].Id && cardId != tmpCardId)
                                { //if we have duplicate cards
                                    if (cardId < tmpCardId)
                                    { //if were on the first occurance of the card
                                        duplicateVisible = "<span class='duplicate'>2</span>";
                                    }
                                    else if (cardId > tmpCardId)
                                    {  //if were on the 2nd occurance of the card
                                        shouldHide = true; //hide entire entry because the first has a counter
                                    }
                                }
                            }

                            if (shouldHide == false)
                            {
                                <div class='cardRow'>
                                    <div class='card' style="background-image: url('/Content/Images/bars/@(deck.Cards[cardId].Id).png');"></div>
                                    <div class='cardFrame'>
                                        <span class='cardCost'>@(deck.Cards[cardId].Cost)</span>
                                        <span class='cardName'>@(deck.Cards[cardId].Name)</span>
                                        @Html.Raw(duplicateVisible)
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </a>
            </div>
        }
    </div>
</div>